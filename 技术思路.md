# Podcast Manager - 技术架构

## 项目概述

自建轻量级播客管理系统，实现"播客订阅 -> 音频转录 -> AI摘要"完整流程。

---

## 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 前端 | React + TailwindCSS | Vite构建，响应式卡片UI |
| 后端 | Python Flask | RESTful API，Blueprint模块化 |
| 数据库 | MongoDB | 灵活schema，本地27017端口 |
| 转录 | AssemblyAI / Faster-Whisper | 云端(说话人分离) / 本地 |
| 摘要 | 本地LLM | 可扩展支持Claude/GPT API |

---

## 项目结构

```
podcast/
|-- backend/                    # Flask后端
|   |-- app/
|   |   |-- __init__.py         # Flask应用工厂
|   |   |-- config.py           # 配置管理
|   |   |-- api/                # API路由
|   |   |   |-- feeds.py        # /api/feeds
|   |   |   |-- episodes.py     # /api/episodes
|   |   |   |-- transcripts.py  # /api/transcripts
|   |   |   |-- summaries.py    # /api/summaries
|   |   |   |-- tasks.py        # /api/tasks
|   |   |   |-- stats.py        # /api/stats
|   |   |-- models/             # 数据模型
|   |   |   |-- feed.py
|   |   |   |-- episode.py
|   |   |   |-- transcript.py
|   |   |   |-- summary.py
|   |   |   |-- task.py
|   |   |-- services/           # 业务逻辑
|   |   |   |-- rss_service.py         # RSS解析
|   |   |   |-- whisper_service.py     # 本地Whisper转录
|   |   |   |-- transcript_fetcher.py  # 外部字幕抓取
|   |   |   |-- llm_client.py          # LLM调用
|   |   |   |-- summary_service.py     # 摘要生成
|   |   |   |-- task_queue.py          # 异步任务队列
|   |   |   |-- prompts/               # 摘要提示词模板
|   |-- media/                  # 媒体文件存储
|   |-- run.py                  # 启动入口
|   |-- requirements.txt
|
|-- frontend/                   # React前端
|   |-- src/
|   |   |-- App.jsx             # 主应用组件
|   |   |-- main.jsx            # 入口
|   |   |-- api/                # API调用封装
|   |   |-- components/
|   |   |   |-- layout/         # 布局组件 (Sidebar)
|   |   |   |-- views/          # 视图组件
|   |   |   |-- cards/          # 卡片组件
|   |   |   |-- player/         # 播放器
|   |   |   |-- tasks/          # 任务面板
|   |-- package.json
|
|-- test/                       # 测试脚本
|   |-- test_assemblyai.py      # AssemblyAI测试
|   |-- transcribe_demis.py     # 转录示例脚本
|
|-- .env                        # 环境变量 (API Keys)
```

---

## 核心功能

### 1. 订阅管理
- 添加/删除RSS订阅源
- 自动解析Feed元数据
- 手动刷新获取新集

### 2. 音频转录
支持多种转录来源：

| 来源 | 说明 | 特点 |
|------|------|------|
| AssemblyAI | 云端API | 说话人分离、自动章节、实体识别 |
| Faster-Whisper | 本地模型 | 免费、隐私、需下载音频 |
| 官方字幕 | 抓取网站 | 部分播客提供官方transcript |

### 3. AI摘要
- 基于转录文本生成结构化摘要
- 支持多种提示词模板 (通用/投资/翻译)
- 中英双语输出

### 4. 异步任务
- 下载/转录/摘要任务后台执行
- 前端轮询获取进度
- 任务状态管理 (pending/processing/completed/failed)

---

## 转录方案对比

### AssemblyAI (推荐用于长播客)

**优势：**
- 说话人分离 (Speaker Diarization)
- 自动章节生成
- 实体识别 (人名、公司等)
- 无需下载音频，直接传URL

**成本：** $0.37/小时

**使用场景：** 2人以上对话、需要区分发言人

### Faster-Whisper (本地)

**优势：**
- 完全免费
- 数据本地化
- 支持多语言

**劣势：**
- 无说话人分离
- 需先下载音频
- 长音频处理慢

**使用场景：** 单人播客、对成本敏感

---

## 数据流

```
RSS Feed URL
    |
    v
[feedparser解析] --> feeds集合 (MongoDB)
    |
    v
Episode列表 --> episodes集合
    |
    +--[下载音频]--> media/audio/
    |
    +--[AssemblyAI]--> 云端转录 (带speaker)
    |       |
    |       v
    +--[Whisper]--> 本地转录
            |
            v
      transcripts集合 (segments含speaker字段)
            |
            v
      [LLM摘要生成]
            |
            v
      summaries集合
```

---

## 关键配置

### .env 文件
```bash
# AssemblyAI (转录)
ASSEMBLYAI_API_KEY=your_key_here

# MongoDB
MONGO_URI=mongodb://localhost:27017
MONGO_DB=podcast

# 媒体存储
MEDIA_ROOT=./media
```

### 启动服务
```bash
# 后端 (端口5000)
cd backend
python run.py

# 前端 (端口3000)
cd frontend
npm run dev
```

---

## 扩展规划

### 已完成
- [x] RSS订阅管理
- [x] 音频下载
- [x] Whisper本地转录
- [x] AssemblyAI云端转录 (说话人分离)
- [x] 前端转录展示 (带Speaker标签)
- [x] 异步任务队列

### 待实现
- [ ] 摘要生成完善
- [ ] 全文搜索
- [ ] 导出到Notion
- [ ] 定时自动更新订阅
- [ ] 向量数据库 (RAG)

---

## 参考资源

- AssemblyAI文档: https://www.assemblyai.com/docs
- Faster-Whisper: https://github.com/SYSTRAN/faster-whisper
- feedparser: https://feedparser.readthedocs.io/

# 播客RSS结构认识

## 概述

播客本质上是通过 **RSS 2.0** 协议分发的音频内容。RSS (Really Simple Syndication) 是一种标准化的XML格式，所有播客平台（Apple Podcasts、Spotify、小宇宙等）都基于这个标准。

---

## RSS结构层级

```
RSS Feed (频道级)
    |
    +-- Feed Info (播客基本信息)
    |       - title, description, image, author...
    |
    +-- Entries (单集列表)
            - Episode 1
            - Episode 2
            - ...
```

---

## 一、Feed级字段 (频道/播客信息)

| 字段 | 说明 | 通用性 | 读取方式 |
|------|------|--------|----------|
| `title` | 播客名称 | 必有 | `d.feed.get("title")` |
| `link` | 播客主页URL | 必有 | `d.feed.get("link")` |
| `description` | 播客简介 | 必有 | `d.feed.get("description")` |
| `subtitle` | 副标题 | 常见 | `d.feed.get("subtitle")` |
| `language` | 语言代码 (en, zh-cn) | 常见 | `d.feed.get("language")` |
| `author` | 作者/主播 | 常见 | `d.feed.get("author")` |
| `image` | 播客封面图 | 必有 | `d.feed.get("image", {}).get("href")` |
| `updated` | 最后更新时间 | 常见 | `d.feed.get("updated")` |
| `generator` | 生成器 (托管平台) | 可选 | `d.feed.get("generator")` |
| `tags/categories` | 分类标签 | 常见 | `d.feed.get("tags")` |

---

## 二、Episode级字段 (单集信息)

### 核心字段 (几乎所有播客都有)

| 字段 | 说明 | 通用性 | 读取方式 |
|------|------|--------|----------|
| `id/guid` | 唯一标识符 | 必有 | `e.get("id") or e.get("guid")` |
| `title` | 单集标题 | 必有 | `e.get("title")` |
| `published` | 发布时间 | 必有 | `e.get("published")` |
| `link` | 单集网页链接 | 必有 | `e.get("link")` |
| `enclosures` | **音频文件** | 必有 | `e.enclosures[0].href` |

### 内容字段

| 字段 | 说明 | 通用性 | 读取方式 |
|------|------|--------|----------|
| `summary` | 简短摘要 | 常见 | `e.get("summary")` |
| `description` | 详细描述 | 常见 | `e.get("description")` |
| `content` | 完整内容 (可能含HTML) | 较少 | `e.content[0].value` |

### iTunes扩展字段

| 字段 | 说明 | 通用性 | 读取方式 |
|------|------|--------|----------|
| `itunes_duration` | 时长 (秒或HH:MM:SS) | 常见 | `e.get("itunes_duration")` |
| `itunes_episode` | 集数编号 | 可选 | `e.get("itunes_episode")` |
| `itunes_season` | 季数 | 可选 | `e.get("itunes_season")` |
| `itunes_explicit` | 是否成人内容 | 可选 | `e.get("itunes_explicit")` |
| `image` | 单集封面 | 可选 | `e.get("image", {}).get("href")` |

### Podcasting 2.0 扩展字段 (新标准，支持率低)

| 字段 | 说明 | 通用性 | 读取方式 |
|------|------|--------|----------|
| `podcast_transcript` | 字幕/转录文件URL | 少见 | `e.get("podcast_transcript")` |
| `podcast_chapters` | 章节标记 | 少见 | `e.get("podcast_chapters")` |

---

## 三、Enclosure 结构 (音频文件)

这是**最关键的字段**，包含实际的音频下载地址。

```python
enclosure = {
    "url": "https://xxx.com/episode.mp3",  # 音频下载地址
    "type": "audio/mpeg",                   # MIME类型
    "length": "54321000"                    # 文件大小(字节)
}
```

### 获取音频URL的通用方法

```python
audio_url = e.enclosures[0].href  # 或 e.enclosures[0].get("href")
```

### 常见音频类型

| type | 格式 |
|------|------|
| `audio/mpeg` | MP3 |
| `audio/mp4` | M4A/AAC |
| `audio/x-m4a` | M4A |
| `audio/ogg` | OGG |

---

## 四、字段通用性总结

### 必有字段 (100%存在)

```python
# Feed级
d.feed.title
d.feed.link
d.feed.description

# Episode级
e.title
e.id / e.guid
e.published
e.enclosures[0].href  # 音频URL
```

### 常见字段 (>80%存在)

```python
e.summary
e.itunes_duration
d.feed.image
d.feed.author
```

### 可选字段 (看平台)

```python
e.podcast_transcript   # Podcasting 2.0
e.podcast_chapters     # Podcasting 2.0
e.itunes_season
e.itunes_episode
```

---

## 五、test3.py 分析方法的通用性

### 结论：是通用方法

test3.py 的实现方式完全符合RSS标准，适用于所有标准播客。

### 通用性保障

1. **使用 feedparser 库** - 这是Python生态最成熟的RSS解析库
2. **兼容性处理** - 使用 `.get()` 方法避免字段缺失报错
3. **多种字段尝试** - 如 `e.get("id") or e.get("guid")` 兼容不同命名
4. **iTunes扩展支持** - 覆盖 `itunes_duration` 等常用扩展
5. **保留原始字段** - `_raw_keys` 方便后续发现新字段

### 适用范围

| 平台 | 兼容性 |
|------|--------|
| Apple Podcasts | 完全兼容 |
| Spotify (有RSS的) | 完全兼容 |
| Google Podcasts | 完全兼容 |
| 小宇宙 | 完全兼容 |
| Pocket Casts | 完全兼容 |
| 独立托管 (Libsyn, Anchor, Buzzsprout) | 完全兼容 |

---

## 六、最小化代码获取音频

```python
import feedparser

feed = feedparser.parse("https://lexfridman.com/feed/podcast/")

# 获取最新一集的音频URL
audio_url = feed.entries[0].enclosures[0].href
title = feed.entries[0].title

print(f"标题: {title}")
print(f"音频: {audio_url}")
```

**只需4行代码即可获取音频URL。**

---

## 七、常见问题

### Q1: 为什么有些播客没有RSS？

Spotify独占播客没有公开RSS。但大多数播客都有RSS，因为这是分发到各平台的标准方式。

### Q2: 如何获取Apple Podcasts的RSS？

Apple Podcasts URL格式: `https://podcasts.apple.com/podcast/id123456`

转换方法:
```python
import requests
podcast_id = "123456"
resp = requests.get(f"https://itunes.apple.com/lookup?id={podcast_id}")
rss_url = resp.json()["results"][0]["feedUrl"]
```

### Q3: enclosures为空怎么办？

极少数情况下enclosures可能在其他字段：
```python
audio_url = (
    e.enclosures[0].href if e.enclosures
    else e.get("media_content", [{}])[0].get("url")
)
```

### Q4: duration格式不统一怎么处理？

```python
def parse_duration(dur):
    """转换为秒数"""
    if not dur:
        return None
    if ":" in str(dur):
        parts = str(dur).split(":")
        if len(parts) == 3:
            return int(parts[0])*3600 + int(parts[1])*60 + int(parts[2])
        elif len(parts) == 2:
            return int(parts[0])*60 + int(parts[1])
    return int(dur)
```

---

## 八、推荐测试RSS源

| 播客 | RSS URL | 特点 |
|------|---------|------|
| Lex Fridman | https://lexfridman.com/feed/podcast/ | 长音频、字段完整 |
| Freakonomics | https://feeds.simplecast.com/Y8lFbOT4 | 有官方transcript |
| The Knowledge Project | https://theknowledgeproject.libsyn.com/rss | 商业内容 |
| Huberman Lab | https://feeds.megaphone.fm/hubermanlab | 科学类 |

---

## 总结

1. **播客RSS是标准化的** - 所有播客都遵循RSS 2.0 + iTunes扩展
2. **feedparser是通用解析方案** - 一个库搞定所有播客
3. **enclosure是核心** - 音频URL必在这里
4. **test3.py的方法完全通用** - 可以直接复用
